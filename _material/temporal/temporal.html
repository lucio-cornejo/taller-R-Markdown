<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Creating a TOC for xaringan</title>
    <meta charset="utf-8" />
    <script src="temporal_files/header-attrs-2.11.4/header-attrs.js"></script>
    <link href="temporal_files/remark-css-0.0.1/rladies.css" rel="stylesheet" />
    <link href="temporal_files/remark-css-0.0.1/uo-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Creating a TOC for xaringan

---


&lt;style&gt;
  #toc-container {
    padding: 0;
    float: left;
    z-index: 100;
    position: absolute;
    bottom: 0;
    left: 0;
    display: block;
    border: 2px solid black;
    background-color: #F0F0F0;
    overflow: auto;
  }

  #toc-container p {
    font-size: 17px;
    margin-top: 8px;
    text-align: center;
    margin-bottom: -10px;
  }

  #toc-container hr {
    border: 0.1px solid gainsboro;
    width: 90%;
  }

  #xaringan-toc {
    margin: 0;
    padding: 5px 30px 10px 40px;
  }
  
  #xaringan-toc li a {
    cursor: pointer;
    color: blue;
  }

  #xaringan-toc li a:hover {
    color: red;
    text-decoration: underline;
  }
&lt;/style&gt;

## Diapo 2

### Section a

a section content

### Section b

b section content

---

&lt;h2 class="no-toc"&gt;Diapo 3&lt;/h2&gt;

### Section a

a section content

### Section b

b section content

---

&lt;p id="texto"&gt;
  No headers in this slide
&lt;/p&gt;

&lt;a&gt;hola&lt;/a&gt;
---

## Diapo 5

### Section a

a section content

### Section b

b section content


&lt;script&gt;
  let body = document.querySelector('body');
  let slidesParent, slides, headers;
  let slidesHeaders = [];
  let toc, tocDiv, tocTitle;

  window.onload = function() {
    // Set variables
    headers = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
    slidesParent = document.querySelector('div.remark-slides-area');

    // Convert some variables to arrays
    headers = Array.prototype.slice.call(headers);
    slides = Array.prototype.slice.call(slidesParent.children);

    // Remove headers with class "no-toc"
    headers = headers.filter(element =&gt; !( element.classList.contains('no-toc') ));

    // Remove last header in headers array, because it's
    // actually the h1 "Help" header from the Xaringan menu 
    // A check will be made, just in case, so not to remove a valuable header:
    if(headers.slice(-1)[0].classList.length === 0 &amp;&amp; headers.slice(-1)[0].textContent === 'Help'){
      headers.pop();
    }

    // Group headers via the slide they belong to
    for(let i=0; i &lt; slides.length; i++){
      let temporal = headers.filter(header =&gt; slides.indexOf(getDivSlideContainer(header)) === i);
      if (temporal.length &gt; 0){
        slidesHeaders.push({ 
          key: i,
          value: temporal
        });
      }  
    }

    // Create an ordered list via slidesHeaders variable
    tocDiv = document.createElement('div');
    tocDiv.id = "toc-container";

    tocTitle = document.createElement('p');
    tocTitle.textContent = "Table of contents";
    tocDiv.append(tocTitle);
    tocDiv.append(document.createElement('hr'));

    toc = document.createElement('ol');
    toc.id = "xaringan-toc";
    tocDiv.append(toc);
    slidesHeaders.forEach( (element) =&gt; {
      element.value.forEach( (header) =&gt; {
        let tocItem = document.createElement('li');
        let anchor = document.createElement('a')
        // Insert header name
        anchor.innerHTML = header.textContent;
        // Pass info about header's slide container
        anchor.setAttribute('data-slide',element.key)
        
        // Add header item to table of contents
        toc.append(tocItem);
        tocItem.append(anchor);
        
      })
    });


    // Pres key t to display Table of Contents
    document.addEventListener('keydown', function(event) {
      if (event.key === "t") {
        if (event.repeat) {
          return;
        }
        if(tocDiv.style.display === 'block') {
          tocDiv.style.display = 'none';
        } else {
          tocDiv.style.display = 'block';
        }
        
        //// Best alternative I've found so far to insert table of contents ////
        // slides[slideshow.getCurrentSlideIndex()].children[0].append(tocDiv);
        // Such alternative has the issue that sometimes double the key press
        // is required in order to show de TOC, due to it being "hidden"
        // after changing slide from a slide where the TOC was displayed.
        
        // Insert table of contents on page
        body.append(tocDiv);

        event.preventDefault();
        event.stopPropagation();
      }
    });

    // Make anchors in Table of Contents activate appropriate slide change when clicked
    toc.children.forEach( (item) =&gt; {
      item.firstChild.addEventListener('click', function(event) {
        slideshow.gotoSlide(1+parseInt(this.dataset.slide));
        event.preventDefault();
        event.stopPropagation();
      })
    });

  }

  function getDivSlideContainer(header) {
    let temporal = header;
    while (! temporal.parentNode.classList.contains('remark-slide-container')) {
      temporal = temporal.parentNode;
    }
    return temporal.parentNode;
  }
&lt;/script&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create();
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
