<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Clase 4: Distill, Blogdown y Bookdown</title>
    <meta charset="utf-8" />
    <meta name="author" content="Lucio Cornejo" />
    <script src="clase-4_files/header-attrs-2.11/header-attrs.js"></script>
    <link href="clase-4_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="clase-4_files/remark-css-0.0.1/shinobi.css" rel="stylesheet" />
    <link href="clase-4_files/remark-css-0.0.1/rladies-fonts.css" rel="stylesheet" />
    <link href="clase-4_files/remark-css-0.0.1/duke-blue.css" rel="stylesheet" />
    <link href="clase-4_files/panelset-0.2.6/panelset.css" rel="stylesheet" />
    <script src="clase-4_files/panelset-0.2.6/panelset.js"></script>
    <link href="clase-4_files/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="clase-4_files/tile-view-0.2.6/tile-view.js"></script>
    <script src="clase-4_files/xaringanExtra_fit-screen-0.2.6/fit-screen.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="my-slides-style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: center, middle, inverse, title-slide



&lt;h1 class = "celeste-ish" style="line-height: 90px; margin-top: -50px;"&gt;
    Clase 4:
    &lt;p style="margin-bottom: -170px;"&gt; &amp;nbsp; &lt;/p&gt;
    Distill,&lt;br&gt;
    Blogdown y&lt;br&gt;
    Bookdown
&lt;/h1&gt;

&lt;h3 class = "celeste-ish" style = "position: absolute; bottom: 80px;"&gt;
  Autor: Lucio Cornejo
&lt;/h3&gt;

---

## Contenido extra para la sesión pasada

- **Xaringan** 
    - La opción `highlightStyle` del YAML de un archivo con `output`
    Xaringan permite algunos valores diferentes al valor
    `highlight` de un archivo con `output` html\_document,
    tal como el tipo de resaltado **dracula**.

    - Otras maneras de crear diapositivas en **R Markdown**:
        - reveal.js
            - &lt;https://bookdown.org/yihui/rmarkdown/revealjs.html&gt;
            - &lt;https://e-gor.github.io/Reveal.js-TOC-Progress/demo/#/&gt;

        - slidy_presentation
            - &lt;https://bookdown.org/yihui/rmarkdown/slidy-presentation.html&gt;
            - &lt;https://pebiba-taller-rmd.netlify.app/index.html#(1)&gt;
    
    - Problema respecto a la [tabla de contenidos](https://github.com/yihui/xaringan/issues/217).
    
    - Convertir las diapositivas a **PDF**:
        - Paquete **pagedown**
      
&lt;p style="margin-bottom: -30px;"&gt; &amp;nbsp; &lt;/p&gt;

- **Sitio web básico creado con R Markdown** 

    - Uso de la función `rmarkdown::render_site()`.
    
    - Uso del archivo `_output.yml`.
    
    - ¿Cómo añadir íconos al sitio web?
        - [Cómo obtener el script necesario.](https://www.youtube.com/watch?v=BATVa4vGZto&amp;ab_channel=EasyTutorials)
        - [Algunas opciones de iconos.](https://www.w3schools.com/icons/icons_reference.asp)

???

Mostrar cómo incluir el script para íconos y el ícono para la 
página principal del sitio, en la carpeta del sitio web,
vía el archivo **_site.yml** 

---

## Distill

### Sitios web creados con Distill

&lt;https://www.jvcasillas.com/&gt;

&lt;https://pkgs.rstudio.com/distill/articles/examples.html&gt;

&lt;p style="margin-bottom: -30px;"&gt; &amp;nbsp; &lt;/p&gt;


### ¿Por qué usar Distill para crear un sitio web?

Es un formato más estable que **Blogdown**, ya que no
requiere de **Hugo**, así que se evita problemas de compatibilidad
(presentes o futuros) entre **Hugo** y **Blogdown**.

&lt;p style="margin-bottom: -50px;"&gt; &amp;nbsp; &lt;/p&gt;

&gt; _La idea fue crear una platforma para ayudar a científicos a aprovechar_
&gt; _los beneficios de la comunicación moderna vía HTML, la cual diseñadores_
&gt; _digitales y periodistas han estado usando para crear artículos_
&gt; _interactivos y atractivos ubicados donde están los lectores:_&lt;br&gt;
&gt; ***en línea (online)***.&lt;br&gt;
&gt; --- https://www.rstudio.com/blog/distill/

???

Comentar sobre el problema actual de compatibilidad de mi
[página](https://lucio-cornejo.github.io/) 
de Mathematical Music theory.

---

## Manos a la obra

- Creación del sitio web&lt;br&gt;


```r
distill::create_blog(dir = "nombre_carpeta", title = "nombre_sitio_web")
```

- Acceder al archivo `_site/index.html`, página principal del sitio web creado.

- Configuremos el archivo `_posts/welcome/welcome.Rmd`, lo renderizamos
y regresamos a la páginal principal del sitio web.

- Creación de un nuevo post&lt;br&gt;


```r
distill::create_post(title = "titulo_publicacion", draft = FALSE)
```

Podemos emplear `draft=TRUE` para que tal publicación no se muestre 
en el sitio web, ya que sería un _borrador_. En el **encabezado YAML**
de aquella publicación podemos cambiar `draft: FALSE` cuando 
el documeto este listo para ser publicado.

???

`create_blog(...) vs create_website(...)` 

- "Blogs Distill" son "sitios web Distill" con extra funcionalidades.
- Para un "blog Distill" es posible que las publicaciones se añadan
automáticamente con su preview y link en la homepage; sin embargo,
eso se tendría que hacer manualmente para "sitios web Distill".
- Cuando se reconstruye un "sitio web Distill", las publicaciones se
renderizan de nuevo, pero eso no ocurre para los "blog Distill", evitando
así posible problemas de compatibilidad tras actualizar paquetes de **RR**.

---

&lt;p style="margin-bottom: -30px;"&gt; &amp;nbsp; &lt;/p&gt;

- Definir el **preview** de la publicación.

- Una **tabla de contenidos** diferente a la que hemos estado empleando.
    
    - `toc: true` 
    - `toc_float: false` 

- Propiedad `code_folding: true` &amp;nbsp;y creación de links para secciones de código.

- Añadir `categories: ["alguna_categoria"]` &amp;nbsp;a la publicación creada y ver el
cambio que produce en la página principal del sitio web.

- Personalizar el diseño del sitio web

    - [Alternativa más rápida](https://rstudio.github.io/distill/website.html#theming)
    (no me funciona)
    - Crear un archivo **CSS** donde modificamos el estilo del sitio,
    y lo incluimos adecuadamente vía el `_site.yml` del sitio web.
        - Esconder la categoría `articles` de la página principal del sitio web.

---
class: middle

- Añadir sección de comentarios y para compartir la publicación:
    - Insertar el siguiente código al archivo `_site.yml` y cambiar
    el valor de `base_url` por el link con el cual se accederá al blog
    creado con **Distill** tras haberlo subido online:
    
      ```yaml
      base_url: https://mathematical-music-theory-blog.netlify.app/
      collections:
        posts:
          disqus:
            shortname: comentarios # nombre cualquiera, pero obligatorio
            hidden: true 
          share: [twitter, linkedin, facebook, google-plus, pinterest]
      ``` 
- Esconder los anuncios (versión Desktop) en la sección de comentarios, 
modificando apropiadamente el archivo `CSS` señalado en `_site.yml`.

- [Más propiedades](https://ymlthis.r-lib.org/reference/yml_distill_opts.html)
para incluir en el **encabezado YAML** de nuestros documentos creados con Distill.

---

&lt;p style="margin-bottom: -70px;"&gt; &amp;nbsp; &lt;/p&gt;

## Publicación del blog creado con Distill

&lt;p style="margin-bottom: -80px;"&gt; &amp;nbsp; &lt;/p&gt;

1. Ejecutamos `rmarkdown::render_site()` tras haber fijado como directorio
  aquel donde se encuentra el archivo **index.Rmd**.
1. En **GitHub**, creamos un repositorio con el mismo nombre que el nombre
  de la carpeta principal de nuestro blog Distill.
1. Ejecutamos en alguna terminal los siguientes comandos, tras cambiar 
  adecuadamente las secciones **ruta-de-la-carpeta-del-blog-Distill**,
  **nombre-de-usuario** y **nombre-del-repositorio**:

  &lt;p style="margin-bottom: -85px;"&gt; &amp;nbsp; &lt;/p&gt;
  
  .scrollable[
  ```text

  cd ruta-de-la-carpeta-del-blog-Distill
  git add .
  git commit -m "initial commit"
  git remote add origin https://github.com/nombre-de-usuario/nombre-del.repositorio.git
  git branch -M main
  git push -u origin main
  ```
  ]

1. Cuando publiquemos el sitio web via **Netlify** y **GitHub**, 
en la sección **Publish directory** escribimos **_site**.
---
class: middle

## Referencias para Distill

- &lt;https://themockup.blog/posts/2020-08-01-building-a-blog-with-distill/&gt;
- &lt;https://rstudio.github.io/distill/blog.html&gt;
- &lt;https://rstudio.github.io/distill/metadata.html&gt;
- &lt;https://rstudio.github.io/distill/&gt;

---
class: middle

## Blogdown

### Ejemplos de blog creados con R Markdown

- &lt;https://malco.io/&gt;
- &lt;https://desiree.rbind.io/&gt;
- &lt;https://hugo-apero-docs.netlify.app/&gt;

Lamentablemente, actualmente ya
[no funciona](https://github.com/rstudio/blogdown/issues/638)
el modelo mostrado, **hugo-acadecmic** (gcushen/hugo-academic),
con **Blogdown**.

Sin embargo, pueden emplear un modelo 
[parecido](https://themes.gohugo.io/themes/meghna-hugo/).

---

## Creamos un sitio web con el paquete Blogdown

Pasos para crear nuestro sitio web con **R Markdown** y el paquete **Blogdown**:&lt;br&gt;
1. Crear un nuevo repositorio en GitHub.
1. En RStudio, crear un nuevo proyecto vía un link del repositorio creado.
1. Ejecutar el siguiente código:
    ```r
    # Instalaciones
    install.packages("blogdown")
    blogdown::install_hugo()
    blogdown::hugo_version() # debe ser más actual que "0.80.0"

    # Creamos el sitio web
    library(blogdown)
    #new_site(theme = "themefisher/meghna-hugo") # otra plantilla
    new_site(theme = "hugo-apero/hugo-apero", 
              format = "toml",
              sample = FALSE,
              empty_dirs = TRUE)
    ```

---

## Modificaciones básicas para personalizar el sitio web

&lt;p style="margin-bottom: -80px;"&gt; &amp;nbsp; &lt;/p&gt;

- `config.toml` &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (comparar con el de mi portafolio)
    &lt;p style="margin-bottom: -60px;"&gt; &amp;nbsp; &lt;/p&gt;
    - `title` 
    - `author` 
    - `[params]` 
        - Cambiar `favicon` y `logo` vía
        `themes/hugo-apero/static/img`&amp;nbsp;&amp;nbsp;.
        - `theme` 
        - `customtextFontFamily` 
        - `customheadingFontFamily`
    - `[menu]`

&lt;p style="margin-bottom: -70px;"&gt; &amp;nbsp; &lt;/p&gt;

- Para otras plantillas, se suele emplear el comando `blogdown::build_site()` 
para que se actualicen los documentos del sitio web 
(análogo a la función `rmarkdown::render_site()` que ya hemos visto).
Sin embargo, para esta plantilla (hugo-apero), basta `push` los cambios 
al repositorio asociado a este blog 
(el cual también se ha vinculado con **Netlify**)
para que se actualice la versión online del blog creado.

???

Tras publicar el blog en **Netlify**, cambiar el `baseURL` en el archivo
`config.toml` por el link del blog online, por ejemplo: &lt;br&gt;
`baseURL = "https://hugo-apero-docs.netlify.app/"`

---
class: middle

- Para incluir cambios personalizados para el diseño visual **(CSS)**
del blog, &lt;br&gt;
modificar el archivo `themes/hugo-apero/assets/custom.scss`.&lt;br&gt;
Para aplicar aquellas alteraciones al blog, en el archivo
`config.toml` incluir en la línea 58 (del archivo default) 
`custom_theme = "custom"` &amp;nbsp;.

- También puedes añadir código de **JavaScript** que desees se aplique en cada
página del blog, incluyendo tal código en el archivo&lt;br&gt;
`themes/hugo-apero/assets/js/main.js` &amp;nbsp;&amp;nbsp;.

- Asimismo, es posible añadir contenido a la sección `head` de cada
sitio web del blog, modificando adecuadamente el archivo&lt;br&gt;
`theme/hugo-apero/layouts/partials/head.html` &amp;nbsp;&amp;nbsp;.

- `content/_index.md` &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(homepage)
&lt;p style="margin-bottom: -60px;"&gt; &amp;nbsp; &lt;/p&gt;
    - `description, image_left, title, ...`
    - `images` &amp;nbsp;&amp;nbsp;(`themes/hugo-apero/static/img`)

---
class: middle

- `content/blog/_index.md` 
&lt;p style="margin-bottom: -60px;"&gt; &amp;nbsp; &lt;/p&gt;

    - `sidebar` &amp;nbsp;&amp;nbsp;(la imagen debe llamarse `sidebar-listing` &amp;nbsp;)
    - `layout` 
        - list (blogs, projects, talks)
        - list-sidebar (blogs, projects, talks)
        - list-grid (solo blogs y projects)

- **Cada sección es configurada por su archivo &amp;nbsp;`_index.md`**&amp;nbsp;&amp;nbsp;.

- **Los thumbnails deben llamarse &amp;nbsp;`featured`&amp;nbsp;**
**(o contener esa palabra en el nombre (ej: `mario-featured.png`))**
**para que Hugo los reconozca como thumbnails**.

- Creamos una nueva publicación en la sección **blog** via el 
**RStudio** addin _New Post_:
    - Señalamos la extensión
    [**Rmarkdown**](https://bookdown.org/yihui/blogdown/output-format.html)
    - Como contenido de aquella publicación, emplearemos el modelo
    de la siguiente diapositiva.

???

Explicar por qué se usa la extensión **.Rmarkdown** y **.markdown** 
en vez de **.Rmd** y **html**.

---

```` 
---
author: Yoshi
layout: single
date: '2022-02-01'
excerpt: |
  Resumen corto.
title: Ejemplo
---

## Ejemplos

```{r}
DT::datatable(mtcars)
```

```{r}
plot(pressure)
```

Ecuación $e^{i\pi} +1 = 0$ en línea.

$$
\sin^2\theta + \cos^2\theta = 1
$$
````

---

- Configuramos la sección **About** del blog:
  &lt;p style="margin-bottom: -70px;"&gt; &amp;nbsp; &lt;/p&gt;

  - Solo realizar los siguientes cambios en `content/about/_index.md` &amp;nbsp;:
  &lt;p style="margin-bottom: -50px;"&gt; &amp;nbsp; &lt;/p&gt;

      - `description` 
      - `show_header` 
      - `sidebar_left` 

  - Cambiar todas las propiedades en `content/about/header/index.md` &amp;nbsp;.

  - `content/about/main/index.md`
      &lt;p style="margin-bottom: -50px;"&gt; &amp;nbsp; &lt;/p&gt;
      
      - `number_featured` 
      - `intro` 

  - `content/about/sidebar/index.md`
      &lt;p style="margin-bottom: -50px;"&gt; &amp;nbsp; &lt;/p&gt;

      - `author` 
      - `role` 
      - `avatar_shape` 
          - La imagen en esa ruta debe llamarse **avatar**
          para que se muestre en el esta parte del blog.
      - `show_social_links` 
      - `audio_link_label` 
          - El audio en aquel directorio debe llamarse **audio** 
          para que se reconozca y se le apliquen estos cambios.
      - `link_list` 

---

class: middle

- Podemos incluir botones como los de la publicación **Palmer Penguins** 
en la sección **Projects**. Para ello, veamos el archivo 
&amp;nbsp;`content/project/penguins/index.md`&amp;nbsp;&amp;nbsp;.

- Es posible crear **series** en las publicaciones del blog, por ejemplo,
siguiendo el modelo de la plantilla para **spoonful-series**, copiando la carpeta,
pegándola y alterándola adecuadamente; por ejemplo, cambiando el nombre a
**xaringan-series** (`series` es necesario en el nombre para ser reconocida como tal)
y alterando la propiedad `series` en el archivo `_index.md` de la carpeta _clonada_.

&lt;p style="margin-bottom: 20px;"&gt; &amp;nbsp; &lt;/p&gt;

## Referencias para Blogdown

- &lt;https://hugo-apero-docs.netlify.app/start/&gt;
- &lt;https://www.youtube.com/watch?v=RksaNh5Ywbo&amp;ab_channel=R-LadiesTunis&gt;
- &lt;https://www.apreshill.com/slides/blogdown-workshop-slides.html#1&gt;

---

## Bookdown

### Motivación

- Limitaciones de **Markdown** que soluciona el paquete **Blogdown**:
    - Numeración automática de figuras y tablas para formato HTML
    - Referenciar tablas y figuras.
    - Gran control sobre la apariencia de las figuras.&lt;br&gt;
    (Actualmente, no es posible controlar el alineamiento de las
    figuras empleando únicamente **Markdown** )

---

&lt;p style="margin-bottom: -70px;"&gt; &amp;nbsp; &lt;/p&gt;

- [Modelo simple para crear el libro](https://github.com/rstudio/bookdown-demo)

- En nuestro caso, crearemos un repositorio en **GitHub** y un nuevo proyecto
en **RStudio**, vinculado a ese repositorio (igual que hicimos con **BLogdown**).

- Una vez dentro de aquel proyecto en **RStudio**, ejecutamos en la consola:&lt;br&gt;
`bookdown::create_gitbook(".")` 

- Antes de renderizar el libro, realicemos algunas modificaciones básicas:
    - `_output.yml` 
        - Propiedad `before` del `toc` 
        - Podemos añadir `number_sections: false`&amp;nbsp; encima de `css`&lt;br&gt;
        para definir si enumeramos las secciones o no.
    - `index.Rmd` 
        - `tile`, `author` y `description`&amp;nbsp;.
    - `_bookdown.yml` 
        - `delete_merged_file` 
        - `chapter_name` 

???

Explicar que la opción **site: bookdown::bookdown_site** 
en el encabezado YAML del archivo `index.Rmd` permite que
**RStudio** renderize el libro **capítulo por capítulo**,
haciendo click en el botón **Knit**, en vez de que se
renderize el libro completo tras presionar aquel botón.

---

La sección `chapter_name` que acabamos de modificar solo afecta
a la versión **HTML** del libro. Para alterar esa misma propiedad,
pero para la versión **PDF** del libro, incluir lo siguiente en 
el encabezado **YAML** del archivo `index.Rmd` &amp;nbsp;:&lt;br&gt;
```yaml
header-includes:
  - \AtBeginDocument{\renewcommand{\chaptername}{nombre_deseado }}
```

- Empleamos el comando `bookdown::render_book()` para renderizar
el libro. 

- Creamos las versiones del libro en los formatos establecidos en
`_output.yml` via el comando `bookdown::render_book(output_format = 'all')`.

- Análogamente a **Blogdown**, existe la función `bookdown::serve_book()`
para visualizar rápidamente cómo los cambios en los archivos del libro
alteran su presentación final.

---

## Ejemplo de YAML para `bookdown::gitbook` 

```yaml
bookdown::gitbook:
  config:
    toc:
      collapse: section # subsection, NULL
    edit: null # ver ejemplo en https://bookdown.org/yihui/bookdown
    download: 
    # En la carpeta _book, donde se encuentra index.html,
    # puedes incluir archivos por descargar cuando se apriete
    # el botón respectivo en la barra superior.
      - ["otro_modelo.pdf","PDF"]
      - ["otro_modelo.epub","EPUB"]
    search: # Busca en todo el libro, no solo en página actual
    # No funciona cuando se abre el libro vía su directorio;
    # requiere un servidor (local o no)
      engine: fuse # lunr
      # ¿Por qué usar fuse.js?
      # https://github.com/rstudio/bookdown/issues/1031
      options:  
      # Opciones para fuse.js https://fusejs.io/api/options.html
        isCaseSensitive: true # Distinguirá mayúsculas que se inserten para buscar
    fontsettings:
      theme: night
      family: serif
      size: 2 # valor por default
    sharing:
      facebook: true
      github: false
      twitter: true
      linkedin: false
      weibo: false
      instapaper: false
      vk: false
      whatsapp: false
      all: ['facebook', 'twitter', 'linkedin', 'weibo', 'instapaper']
    info: true
```

---
class: middle

## Referenciar entornos de ecuaciones

```md
\begin{equation} 
  f\left(k\right) = \binom{n}{k} p^k\left(1-p\right)^{n-k}
  (\#eq:ecuacion)
\end{equation} 

Notemos que en la ecuación \@ref(eq:ecuacion) se cumple ...
```

```md
\begin{align} 
  g(X_{n}) &amp;= g(\theta)+g'({\tilde{\theta}})(X_{n}-\theta) \notag \\
  \sqrt{n}[g(X_{n})-g(\theta)] &amp;= g'\left({\tilde{\theta}}\right)
  \sqrt{n}[X_{n}-\theta ] (\#eq:alineado)
\end{align} 

La notación ahora es \@ref(eq:alineado)
```

Hay que asegurarse de no enumerar ecuaciones que no poseen _etiqueta_,
ya sea alterando los entornos como `equation*` o empleando
`\nonumber` o `\notag` apropiadamente.

---

## Entornos definidos vía `Pandoc` y `Bookdown` 

### Ejemplo (funciona para formato HTML y PDF, no EPUB)

```md
::: {.theorem #famoso name="Identidad de Euler"}
Para cualquier $\theta\in\mathbb{R}$ se cumple 

$$e^{i\theta}= \cos\theta + i\sin\theta$$
:::

El teorema \@ref(thm:famoso) es el más elegante según ciertos matemáticos.
```

&lt;p style="margin-bottom: 0px;"&gt; &amp;nbsp; &lt;/p&gt;

.center[

### Posibilidades

&lt;p style="margin-bottom: -30px;"&gt; &amp;nbsp; &lt;/p&gt;

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Entorno &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Nombre impreso &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Prefijo de etiqueta &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; theorem &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Theorem &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; thm &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; lemma &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Lemma &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; lem &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; corollary &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Corollary &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; cor &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; proposition &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Proposition &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; prp &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; conjecture &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Conjecture &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; cnj &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; definition &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Definition &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; def &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; example &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Example &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; exm &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; exercise &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Exercise &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; exr &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; hypothesis &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Hypothesis &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; hyp &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

???

Mostrar un ejemplo con el entorno **hypothesis**.

---

## Referencias de texto

&lt;p style="margin-bottom: -80px;"&gt; &amp;nbsp; &lt;/p&gt;


`(ref:ejemplo) ~~Referencias~~ de **una línea** y _sin espacio vacío al final_.` 

````
```{r, fig.cap="(ref:ejemplo)"} 
plot(pressure)
```
````

&lt;p style="margin-bottom: -25px;"&gt; &amp;nbsp; &lt;/p&gt;

## Referencia a imágenes y mayor control de los gráficos

&lt;p style="margin-bottom: -80px;"&gt; &amp;nbsp; &lt;/p&gt;

````
```{r, etiqueta}
#| fig.cap: "Gráfica de ejemplo"
#| fig.asp: 1             # proporción altura/ancho de la figura
#| fig.width: 6           # 6 pulgadas de ancho para la imagen
#| fig.align: "center"    # centrar la figura

plot(pressure)
```

Referencia a la imagen \@ref(fig:etiqueta) .
```` 

---
class: middle

Podemos refenciar la imagen previa vía el nombre del chunk donde
fue creada y la sintáxis `\@ref(fig:label)`, pero para que funcione
**es necesario que aquel chunk tenga algún valor para _fig.cap_**.

&lt;p style="margin-bottom: -30px;"&gt; &amp;nbsp; &lt;/p&gt;

## Referencia a tablas

&lt;p style="margin-bottom: -80px;"&gt; &amp;nbsp; &lt;/p&gt;

Podemos emplear la función **kable** del paquete **knitr**
para crear tablas y que se les asigne una **etiqueta** en
base al nombre del chunk donde se crea la tabla.

````
```{r tabla} 
knitr::kable(
  head(mtcars[, 1:8], 10), booktabs = TRUE,
  caption = 'Tabla cualquiera'
)
```

Referencia para \@ref(tab:tabla)
````

&lt;p style="margin-bottom: -20px;"&gt; &amp;nbsp; &lt;/p&gt;

## _Cross-references_

&lt;p style="margin-bottom: -70px;"&gt; &amp;nbsp; &lt;/p&gt;

```md
Link para sección [Render book]

Link para [una de las secciones pasadas][Render book]
```

---
class: middle

## Personalización del texto de las etiquetas (para HTML)

&lt;p style="margin-bottom: -80px;"&gt; &amp;nbsp; &lt;/p&gt;

Algunas opciones que se pueden incluir en el archivo `_bookdown.yml`:

```yaml
language:
  label:
    fig: 'Figura '
    tab: 'Tabla '
    eq: 'Ecuación '
    thm: 'Teorema '
    lem: 'Lema '
    cor: 'Corolario '
    prp: 'Proposición '
    cnj: 'Conjetura '
    def: 'Definición '
    exm: 'Ejemplo '
    exr: 'Ejercicio '
    hyp: 'Hipóthesis '
    proof: 'Prueba. '
    remark: 'Observación. '
    solution: 'Solución. '
```

---
class: middle

## Resaltado del código mostrado

&lt;p style="margin-bottom: -50px;"&gt; &amp;nbsp; &lt;/p&gt;

### Incluir en archivo `_output.yml`

```yaml
bookdown::gitbook:
  highlight: espresso # tango, pygments, kate, monochrome, espresso, zenburn, haddock, breezedark, default .
```

&lt;p style="margin-bottom: 0px;"&gt; &amp;nbsp; &lt;/p&gt;

### Incluir en archivo `style.css`

```css
div.sourceCode *:not(button) {
  background: inherit !important;
}
```

---
class: middle

## Personalización vía HTML y JavaScript

&lt;p style="margin-bottom: -80px;"&gt; &amp;nbsp; &lt;/p&gt;

Así como en los paquetes previos expuestos en esta sesión,
es posible anexar código de HTML o de JavaScript a cada página
del documento/libro vía el archivo 
&amp;nbsp;`_output.yml`&amp;nbsp; de la siguiente manera:

```yaml
bookdown::gitbook:
  includes:
    in_header: ejemplo-01.html    # incluir en el interior de &lt;head&gt;
    before_body: ejemplo-02.html  # incluir al inicio del interior de &lt;body&gt;
    after_body: ejemplo-03.html   # incluir al final del interior de &lt;body&gt;
```

---

## `Bookdown`: _Transferencia de poderes_

&lt;p style="margin-bottom: -85px;"&gt; &amp;nbsp; &lt;/p&gt;

Si tu publicación consiste de un único documento (sea largo o no)
en formato `html_document`&amp;nbsp; , `pdf_document`&amp;nbsp; o  `word_document`&amp;nbsp;,
puedes implementarle la
**enumeración automática de figuras, tablas y ecuaciones**,
además del **cross-referencing de figuras, tablas, ecuaciones y secciones**
(funcionalidades que **Bookdown** implementó para **R Markdown**)
cambiando de la siguiente manera el encabezado YAML de tu documento:

```yaml
# Ejemplo de "ANTES"
output: 
  html_document: default
  pdf_document: default
  word_document: default
```

```yaml
# Ejemplo de "DESPUÉS"
output: 
  bookdown::html_document2: default
  bookdown::pdf_document2: default
  bookdown::word_document2: default
```

---

&lt;p style="margin-bottom: -60px;"&gt; &amp;nbsp; &lt;/p&gt;

## Renderizar un solo capítulo en vez de todo el libro

&lt;p style="margin-bottom: -85px;"&gt; &amp;nbsp; &lt;/p&gt;

`bookdown::preview_chapter('nombre_archivo_capitulo.Rmd')` 

## Modificar el orden de los capítulos

&lt;p style="margin-bottom: -90px;"&gt; &amp;nbsp; &lt;/p&gt;

En el archivo `_bookdown.yml`, puedes definir el orden de los
capítulos que establece tus documentos **R Markdown**, 
de las siguientes maneras:

```yaml
# Orden para todos los outputs
rmd_files: ["index.Rmd", "abstract.Rmd", "intro.Rmd"]
```

```yaml
# Orden para cada tipo de output
rmd_files: 
  html: ["index.Rmd", "abstract.Rmd", "intro.Rmd"]
  latex: ["abstract.Rmd", "intro.Rmd"]  # para PDF
```

## Formato `bookdown::bs4_book`

&lt;p style="margin-bottom: -90px;"&gt; &amp;nbsp; &lt;/p&gt;

Por ahora, basta remover &amp;nbsp;`number_sections`&amp;nbsp;
y &amp;nbsp;`highlight`&amp;nbsp;
de &amp;nbsp;`_output.yml`&amp;nbsp;&amp;nbsp;, cambiar el formato
en tal archivo y renderizar el libro.

---

## Publicamos el libro online de manera gratuita

&lt;p style="margin-bottom: -80px;"&gt; &amp;nbsp; &lt;/p&gt;

Una vez que ya hemos renderizado el libro por completo y está
listo para ser publicado, podemos emplear **RStudio Connect**
para la publicación. 

&lt;p style="margin-bottom: -30px;"&gt; &amp;nbsp; &lt;/p&gt;

### Pasos

1. Crear una cuenta en [RStudio Connect](https://bookdown.org/connect/).

1. Ejecutar `install.packages('rsconnect')` en la consola de **RStudio**.

1. Ejecutar `bookdown::publish_book()` para publicar el libro.&lt;br&gt;
Cuando emplees aquel comando por primera vez, se te pedirá
una corta autentificación.

1. En caso desees actualizar el libro, tras haberlo renderizado,
ejectua el mismo comando `bookdown::publish_book()` tras haberte
asegurado que **RStudio** está empleando como directorio la ruta
donde se almacenan los archivos de tu libro.

???

Mostrar también cómo hacerlo vía Netlify y GitHub,
para poder tener **version control**.

---
class: middle

## Referencias para Bookdown

- &lt;https://bookdown.org/yihui/bookdown/&gt;
- [Formato bookdown::bs4_book](https://bookdown.org/yihui/bookdown/html.html#bs4-book)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "dracula",
"highlightLines": true,
"countIncrementalSlides": true,
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<script>
    // Code to change color of slide number when the current slide has presentator notes
    function change_slide_number_color() {
        
        // Check notes section of current slide
        let notas = document.querySelector('div.remark-notes'); 
        
        // Get all the slide number div tags
        let numero_diapositiva = document.querySelectorAll('div.remark-slide-number'); 
        
        // Check if the are notes in current slide
        if( !(notas.children.length === 0) ) {
            // Color current slide number when there are notes in current slide
            numero_diapositiva[slideshow.getCurrentSlideIndex()].style.color = "red";
        }
    }
    
    // Repeating this function every 0.2 seconds does not affect the web's performance 
    // (lag and loading time, for example) in any significant way, at least in my weak laptop.
    setInterval(change_slide_number_color, 200)

    // Code to fix the change of slide when scrolling and when clicking some elements
    let touchmoved;
    $('div.remark-slide-container').on('touchend', function(event){
        if(touchmoved === true) {
            // Do not change slide if scrolling took place
            event.preventDefault(); 
            event.stopPropagation();
        } else {
            // Fix for issue when clicking an image with an anchor
            if(event.target.tagName === "IMG") {
                if (event.target.parentNode.getAttribute("href").includes("https:")) {
                    // If there was no scrolling and the user clicked on an image
                    // which has an anchor, then do not change slide and open
                    // in a next window the site linked to image touched
                    event.preventDefault(); 
                    event.stopPropagation();
                    window.open(event.target.parentNode.getAttribute("href"));
                } 
            }
            
            // Fix for issue when clicking the symbol of a <details><summary> ...
            if (event.target.tagName === "SUMMARY") {
                if(event.target.parentNode.tagName === "DETAILS") {
                    event.preventDefault();
                    event.stopPropagation();
                    // Manually toggle between open or closed <details>
                    if(event.target.parentNode.open === true) {
                        event.target.parentNode.open = false;
                    } else {
                        event.target.parentNode.open = true;
                    }
                }
            }
        }
    }).on('touchmove', function(){
        touchmoved = true;
    }).on('touchstart', function(){
        touchmoved = false;
    });

    //// Code to chage between slides depending on user screen swipe ////
    // Such option is supossed to work already in Xaringan, but it was not working for me :(
    let touchstartX = 0;
    let touchendX = 0;
    let swiped = false;

    function conditional_swipe() {
        // Swiped left
        if (touchendX < touchstartX) {
            if ( (touchstartX - touchendX) > (screen.availWidth)*0.25 ) slideshow.gotoNextSlide();
        } else {
            // Swiped right, because swiped equals true
            if ( (touchendX - touchstartX) > (screen.availWidth)*0.25 ) slideshow.gotoPreviousSlide();
        }
    }
        
    $('div.remark-slide-container').on('touchstart', event => {
        touchstartX = event.changedTouches[0].screenX;
        swiped = false;
    });

    $('div.remark-slide-container').on('touchmove', function() { swiped = true; });

    $('div.remark-slide-container').on('touchend', event => {
        touchendX = event.changedTouches[0].screenX;
        if (swiped === true) conditional_swipe();
    });
</script>
<script>
  ////  Creation of a table of contents for Xaringan  ////
  let body;
  let slidesParent, slides, headers;
  let slidesHeaders = [];
  let helpMenu;
  let toc, tocDiv, tocTitle;
  
  let resizeSlides; // variable for manual slide resize (different than slides variable)

  document.addEventListener('DOMContentLoaded', function() {
    // Set variables
    body = document.querySelector('body');
    helpMenu = document.querySelector('div.remark-help');
    helpMenu.setAttribute('style','overflow: auto;'); // Show all keyboard commands for Xaringan
    slidesParent = document.querySelector('div.remark-slides-area');

    ////////////////////////////////////////////////////////////////////
    //// Remove the headers which have been set not be added to TOC ////

    // Important to search for headers only in div.remark-slides-area, 
    // because, if not, there are  headers that get added more than once to the variable "headers"
    headers = document.querySelectorAll('div.remark-slides-area h1, div.remark-slides-area h2, div.remark-slides-area h3, div.remark-slides-area h4, div.remark-slides-area h5, div.remark-slides-area h6');

    // Convert some variables to arrays
    headers = Array.prototype.slice.call(headers);
    slides = Array.prototype.slice.call(slidesParent.children);

    // Remove the header h1 "Help" from the Xaringan menu
    for (let i =0; i< headers.length; i++){
      if(headers[i].classList.length === 0 && headers[i].textContent === 'Help'){
        headers.splice(i,1);
      }
    }

    // Remove headers with class "no-toc"
    headers = headers.filter(header => !( header.classList.contains('no-toc') ));
    
    // Remove headers which were applied ".no-toc[ some_header ]" in the R Markdown code
    headers = headers.filter(header => !( header.parentNode.classList.contains('no-toc') && header.parentNode.tagName==='DIV'));

    // Remove headers contained in a slide to which "class: no-toc" was applied
    headers = headers.filter( (header) => {
      let temporal = getDivSlideContainer(header).firstChild.firstChild.firstChild;
      // Check that the child chosen is the div with class "remark-slide-content",
      // the one to which the class "no-toc" would be added if "class: no-toc" was used
      if ( temporal.classList.contains('remark-slide-content') && temporal.tagName === 'DIV' ) {
        if( temporal.classList.contains('no-toc') ){
          // Remove this header
          return false;
        } else {
          // Do not remove this header
          return true;
        }
      }
    });
    ////////////////////////////////////////////////////////////////////

    // Group headers via the slide they belong to
    for(let i=0; i < slides.length; i++){
      let temporal = headers.filter(header => slides.indexOf(getDivSlideContainer(header)) === i);
      if (temporal.length > 0){
        slidesHeaders.push({ 
          key: i,
          value: temporal
        });
      }  
    }

    // Create an ordered list via slidesHeaders variable
    tocDiv = document.createElement('div');
    tocDiv.id = "toc-container";

    tocTitle = document.createElement('p');
    tocTitle.textContent = "Table of contents";
    tocDiv.append(tocTitle);
    tocDiv.append(document.createElement('hr'));

    toc = document.createElement('ol');
    toc.id = "xaringan-toc";
    tocDiv.append(toc);
    slidesHeaders.forEach( (element) => {
      element.value.forEach( (header) => {
        let tocItem = document.createElement('li');
        let anchor = document.createElement('a')
        // Insert header name
        anchor.innerHTML = header.textContent;
        // Pass info about header's slide container
        anchor.setAttribute('data-slide',element.key)
        
        // Add header item to table of contents
        toc.append(tocItem);
        tocItem.append(anchor);
        
      })
    });


    ////////////////////////////////////////////////////////////
    //// Set default stylings via JavaScript instead of CSS ////
  
    // Insert tocDiv in page (but hide it), to set its styles
    body.append(tocDiv);

    document.querySelector('html').setAttribute('style',"scroll-behavior: smooth;");
    document.querySelector('#toc-container').setAttribute('style',"padding: 0; float: left; z-index: 100; position: absolute; bottom: 0; left: 0; display: block; border: 2px solid black; background-color: #F0F0F0; overflow: auto; min-width: 10vw;  height: 50vh; resize: horizontal;");
    // Hide table of contents
    tocDiv.style.display = "none";

    document.querySelector('#toc-container p').setAttribute('style',"font-size: 17px; margin-top: 8px; text-align: center; margin-bottom: -10px;");
    document.querySelector('#toc-container hr').setAttribute('style',"border: 0.1px solid gainsboro; width: 90%;");
    document.querySelector('#xaringan-toc').setAttribute('style',"margin: 0; padding: 5px 30px 10px 40px;");
    
    // Style properties for anchors of table of contents
    let css = "#xaringan-toc li a { cursor: pointer; color: blue; transition: all 260ms linear; }"+"\n"+"#xaringan-toc li a:hover { color: red; text-decoration: underline; }";
    let style = document.createElement('style');
    if (style.styleSheet) {
        style.styleSheet.cssText = css;
    } else {
        style.appendChild(document.createTextNode(css));
    }
    document.querySelector('head').appendChild(style);
    ////////////////////////////////////////////////////////////


    // Pres key t to display Table of Contents
    document.addEventListener('keydown', function(event) {
      if (event.key === 'd') {
        if (event.repeat) {
          return;
        }

        // Update opacity, line-through and font-weight of toc's anchors
        updateTocAnchorsStyle();

        //// Best alternative I've found so far to insert table of contents ////
        // slides[slideshow.getCurrentSlideIndex()].children[0].append(tocDiv);
        // Such alternative has the issue that sometimes double the key press
        // is required in order to show de TOC, due to it being "hidden"
        // after changing slide from a slide where the TOC was displayed.
        
        // Default toc stylings
        tocDiv.style.top = '';
        tocDiv.style.width = 'auto';
        tocDiv.style.height = '50vh';

        if(tocDiv.style.display === 'block') {
          tocDiv.style.display = 'none';
        } else {
          tocDiv.style.display = 'block';
          // Insert table of contents on page
          body.append(tocDiv);
        }
      }
    });

    // Make anchors in Table of Contents activate appropriate slide change when clicked
    toc.children.forEach( (item) => {
      item.firstChild.addEventListener('click', function(event) {
        // Go to appropriate slide
        slideshow.gotoSlide(1+parseInt(this.dataset.slide));

        // Close and open table of contents in order to activate
        // line-through and opacity change of previous anchors
        switch (tocDiv.style.height) {
          case '100vh':
            document.dispatchEvent(new KeyboardEvent('keydown',{'key':'e'}));
            document.dispatchEvent(new KeyboardEvent('keydown',{'key':'e'}));
            break;
          default:
            // We assume the height is either 50vh or some custom one aparat from 100vh
            document.dispatchEvent(new KeyboardEvent('keydown',{'key':'d'}));
            document.dispatchEvent(new KeyboardEvent('keydown',{'key':'d'}));
            break;
        }

        // Scroll the table of contents to the anchor just clicked
        this.scrollIntoView();
      })
    });

    // Press s in order to stick table of contents to the left empty side
    // of Xaringan slides, if there is any such empty space
    document.addEventListener('keydown', function() {
      if (event.key === 'e') {
        if (event.repeat) {
          return;
        }

        // Update opacity, line-through and font-weight of toc's anchors
        updateTocAnchorsStyle();

        // Check if there is empty space where to insert the toc
        let someSlide = document.querySelector('div.remark-slide-scaler');
        if (parseInt(someSlide.style.left.slice(0,-2)) === 0) {
        } else {
          tocDiv.style.width = String(Math.round(parseInt(someSlide.style.left.slice(0,-2))*1))+'px';
          tocDiv.style.height = '100vh';
          tocDiv.style.top = '0';
        }

        if(tocDiv.style.display === 'block') {
          tocDiv.style.display = 'none';
        } else {
          tocDiv.style.display = 'block';
          // Insert table of contents on page
          body.append(tocDiv);
        }
      }
    });

    // Select the slide divs which set the slide dimensions
    resizeSlides = slides.map(slide => slide.firstChild);
    resizeSlides.forEach(slide => slide.style.resize = "horizontal");

    resizeSlides.forEach( (slide) => {
      new ResizeObserver(resizeAllSlides).observe(slide);
    });

    // In the Help menu, show descriptions of the commands added
    let newCommandsKeys = [["e","Show TOC with height equal to the page's"],
                           ["d","Show TOC with half the page's height"],
                           ["r","Move all the slides to the right side of the page"]
                          ];
    newCommandsKeys.forEach( (commandInfo) => {
      let tableRow =  document.createElement('tr');
      let tableData = document.createElement('td');
      let newCommandKey = document.createElement('span');
      newCommandKey.className = "key";
      newCommandKey.textContent = commandInfo[0];
      let commandAction = document.createElement('td');
      commandAction.textContent = commandInfo[1];
      // Append (as in the Help menu structure) the elements created
      tableData.appendChild(newCommandKey);
      tableRow.appendChild(tableData);
      tableRow.appendChild(commandAction);
      // Append new command info to Help menu
      document.querySelector('div.remark-help table tbody').appendChild(tableRow);
    });

  });

  function getDivSlideContainer(header) {
    let temporal = header;
    while (! temporal.parentNode.classList.contains('remark-slide-container')) {
      temporal = temporal.parentNode;
    }
    return temporal.parentNode;
  }

  function pushSlidesToRight() {
    // Get real width of current slide and push slide to the right of screen
    let temporal = screen.availWidth - resizeSlides[slideshow.getCurrentSlideIndex()].getBoundingClientRect().width ;
    resizeSlides.forEach(slide => { slide.style.left = String(Math.round(temporal))+'px'; });

    // Close and open table of contents in order to fix width
    if ( tocDiv.style.height === '100vh') {
      document.dispatchEvent(new KeyboardEvent('keydown',{'key':'e'}));
      document.dispatchEvent(new KeyboardEvent('keydown',{'key':'e'}));
    }
  }

  document.addEventListener('keydown', function(event) {
    if (event.key === 'r') {
        if (event.repeat) {
          return;
        }
        pushSlidesToRight();
    }
  });

  function resizeAllSlides() {
    let currentSlide = resizeSlides[slideshow.getCurrentSlideIndex()];
    resizeSlides.forEach(slide => { 
      // slide.style.width = String(Math.round(currentSlide.getBoundingClientRect().width))+'px';
      slide.style.width = String(currentSlide.offsetWidth) + 'px';
    });
  }

  $(document).on('webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange', async function() {
    // Whenever a change from or to fullscreen window occurs,
    // wait a while (because slides take a little time to get resized)
    // and do the following:

    await sleep(200);

    // Resize the toc even if it was not open during this event
    if (tocDiv.style.height === '100vh') {
      document.dispatchEvent(new KeyboardEvent('keydown',{'key':'e'}));
      document.dispatchEvent(new KeyboardEvent('keydown',{'key':'e'}));
    } else {
      document.dispatchEvent(new KeyboardEvent('keydown',{'key':'d'}));
      document.dispatchEvent(new KeyboardEvent('keydown',{'key':'d'}));
    }
  });

  function updateTocAnchorsStyle() {
    // Update opacity, line-through and font-weight of toc's anchors
    let currentSlide = slideshow.getCurrentSlideIndex();
    toc.children.forEach( (element) => {
      if ( currentSlide > 0 ) {
        if ( parseInt(element.firstChild.dataset.slide) < currentSlide ) {
          element.firstChild.style.opacity = 0.5;
          element.firstChild.style.fontWeight = 400;
          element.firstChild.style.textDecoration = "line-through";
        } else {
          if ( parseInt(element.firstChild.dataset.slide) === currentSlide ) {
            element.firstChild.style.opacity = 1;
            element.firstChild.style.fontWeight = 900;
            element.firstChild.style.textDecoration = "";
          } else {
            element.firstChild.style.opacity = 1;
            element.firstChild.style.fontWeight = 400;
            element.firstChild.style.textDecoration = "";

          }
        }
      } else {
        // Currrent slide is the first one, so undo anchor style changes
        element.firstChild.style.opacity = 1;
        element.firstChild.style.fontWeight = 400;
        element.firstChild.style.textDecoration = "";
        
        // Bold anchors from first slide
        if (element.firstChild.dataset.slide === '0') {
          element.firstChild.style.fontWeight = 900;
        }
      }
    });
  }

  // Refresh toc after a slide change
  slideshow.on('afterShowSlide', async function() {
    // Wait some time so that the new slide index gets recognized
    await sleep(100);

    // Update the style of the table of contents' anchors
    updateTocAnchorsStyle();
  });

  // Define the standard sleep() function
  function sleep(miliseconds) {
    return new Promise(resolve => setTimeout(resolve, miliseconds));
  }
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
